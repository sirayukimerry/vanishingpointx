<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>内部調査報告書｜ARA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 共通CSS -->
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    /* ===== 表（死亡事案） ===== */
    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    .report-table th,
    .report-table td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    .report-table th {
      background: #f0f0f0;
      font-size: 13px;
      letter-spacing: 0.08em;
    }
    .report-table input {
      width: 95%;
      padding: 6px;
    }

    /* ===== 提出ボタン中央寄せ ===== */
    .submit-center {
      text-align: center;
    }

    /* ===== モーダル ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .modal {
      background: #fff;
      max-width: 520px;
      padding: 32px;
      border: 1px solid #ccc;
    }
    .modal h2 {
      font-size: 14px;
      letter-spacing: 0.12em;
      margin-bottom: 20px;
    }
    .modal p {
      font-size: 14px;
      line-height: 1.9;
      margin-bottom: 16px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
      margin-top: 24px;
    }

    /* ★ モーダル内提出ボタン（常に見える） */
    .modal-submit {
      background: #eee;
      color: #000;
      border: 1px solid #333;
      padding: 10px 20px;
      cursor: not-allowed;
      opacity: 0.4;
    }
    .modal-submit.enabled {
      background: #111;
      color: #fff;
      cursor: pointer;
      opacity: 1;
    }

    .guard-text {
      font-size: 12px;
      color: #b00020;
      margin-top: 12px;
      display: none;
    }

    /* ===== 提出後演出 ===== */
    .submit-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      text-align: center;
    }
    .submit-overlay.active {
      display: flex;
    }
    .hidden {
      display: none;
    }

    .lock-scroll {
      overflow: hidden;
    }
  </style>

</head>
  
 <!-- =========================
     ナビバー（共通）
     ========================= -->
<header class="navbar">

  <!-- 左：ロゴ -->
  <div class="nav-left">
    <a href="ara.html">
      <img src="assets/img/logo.png" alt="ARAロゴ" class="nav-logo">
    </a>
  </div>

  <!-- 中央：メニュー -->
  <nav class="nav-center">
    <a href="index.html">ホーム</a>
    <a href="staff.html">職員照会</a>
    <a href="archive.html">アーカイブ</a>
    <a href="individual.html">マイページ</a>
  </nav>

  <!-- 右：検索 -->
  <div class="nav-right">
    <input type="search" class="nav-search" placeholder="キーワードを検索">
  </div>

</header>
<body>

<main class="page document-page">

  <h1 class="document-title">内部調査報告書</h1>

  <!-- ===== 死亡事案 ===== -->
  <section class="document-section">
    <h2>死亡事案の整理</h2>

    <table class="report-table" id="killTable">
      <tr>
        <th>被害者</th>
        <th>殺害者</th>
      </tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
    </table>
  </section>

  <!-- ===== アノマリー ===== -->
  <section class="document-section">
    <h2>アノマリーの所在</h2>
    <textarea id="anomalyAnswer" rows="4" style="width:100%"></textarea>
  </section>

  <!-- ===== 再発防止策 ===== -->
  <section class="document-section document-secret">
    <h2>再発防止策の選択</h2>

    <label>
      <input type="radio" name="finalDecision"> アノマリーの完全破壊
    </label><br>
    <label>
      <input type="radio" name="finalDecision"> 管理・運用体制の見直し
    </label><br>
    <label>
      <input type="radio" name="finalDecision"> 判断不能（保留）
    </label>
  </section>

  <!-- ===== ページ提出（①） ===== -->
  <section class="document-section submit-center">
    <button class="primary-button" onclick="openConfirmModal()">
      提出する
    </button>
  </section>

</main>

    <footer class="site-footer">
  <p class="footer-note">
    このWebサイトの内容はフィクションであり、実在の人物・団体とは一切関係がありません。
  </p>
  <p class="footer-copy">
    ©2026　白雪メリー
  </p>
</footer>

<!-- ===== モーダル ===== -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal">
    <h2>最終確認</h2>

    <p>
      本報告を提出した場合、<br>
      内容の修正および再提出はできません。
    </p>

    <!-- 未選択ガード表示 -->
    <p class="guard-text" id="guardText">
      ※ 再発防止策を選択してください
    </p>

    <div class="modal-actions">
      <button onclick="closeModal()">戻る</button>

      <!--  最終提出ボタン -->
      <button id="finalSubmitBtn" class="modal-submit">
        提出する
      </button>
    </div>
  </div>
</div>

<!-- ===== 提出後演出 ===== -->
<div id="submit-overlay" class="submit-overlay">
  <div>
    <p>報告書を提出しています…</p>
    <p id="line2" class="hidden">評価を算出しています…</p>
  </div>
</div>

<script>
/* =========================
   正解データ
   ========================= */
const correctPairs = [
  ["クレア・タウナー", "アンバー・イェイツ"],
  ["ブラッドリー・ホースウッド", "アンバー・イェイツ"],
  ["ダスティン・マクマホン", "フェリックス・オーウェン"],
  ["アンバー・イェイツ", "フェリックス・オーウェン"],
  ["ジャネット・フォスター", "イサク・エノモト"],
  ["イサク・エノモト", "メティス・ゼズルカ"],
  ["ハルナ・キノサキ", "メティス・ゼズルカ"]
];

const anomalyCorrect = ["アイトネ・バラティエ"];

/* =========================
   モーダル開閉（①）
   ========================= */
function openConfirmModal() {
  document.getElementById("confirmModal").style.display = "flex";
}
function closeModal() {
  document.getElementById("confirmModal").style.display = "none";
}

/* =========================
   未選択ガード
   ========================= */
const radios = document.querySelectorAll('input[name="finalDecision"]');
const submitBtn = document.getElementById("finalSubmitBtn");
const guardText = document.getElementById("guardText");

radios.forEach(r => {
  r.addEventListener("change", () => {
    submitBtn.classList.add("enabled");
    submitBtn.disabled = false;
    guardText.style.display = "none";
  });
});

/* =========================
   最終提出処理
   ========================= */
submitBtn.addEventListener("click", () => {
  if (!submitBtn.classList.contains("enabled")) {
    guardText.style.display = "block";
    return;
  }

  // スクロール拘束＋演出
  document.body.classList.add("lock-scroll");
  document.getElementById("confirmModal").style.display = "none";

  const overlay = document.getElementById("submit-overlay");
  overlay.classList.add("active");

  setTimeout(() => {
    document.getElementById("line2").classList.remove("hidden");
  }, 600);

  // 採点
  let score = 0;
  document.querySelectorAll("#killTable tr").forEach((row, i) => {
    if (i === 0) return;
    const v = row.children[0].querySelector("input").value.trim();
    const k = row.children[1].querySelector("input").value.trim();
    if (correctPairs.some(p => p[0] === v && p[1] === k)) score += 10;
  });

  const anomaly = document.getElementById("anomalyAnswer").value;
  if (anomalyCorrect.some(a => anomaly.includes(a))) score += 30;

  let rank = "C";
  if (score === 100) rank = "S";
  else if (score >= 80) rank = "A";
  else if (score >= 50) rank = "B";

  sessionStorage.setItem("score", score);
  sessionStorage.setItem("rank", rank);

  setTimeout(() => {
    window.location.href = "epilog.html";
  }, 1600);
});
</script>

</body>
</html>
