<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å†…éƒ¨èª¿æŸ»å ±å‘Šæ›¸ï½œARA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- å…±é€šCSS -->
  <link rel="stylesheet" href="assets/css/style.css">

  <style>
    /* ===== è¡¨ï¼ˆæ­»äº¡äº‹æ¡ˆï¼‰ ===== */
    .report-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    .report-table th,
    .report-table td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    .report-table th {
      background: #f0f0f0;
      font-size: 13px;
      letter-spacing: 0.08em;
    }
    .report-table input {
      width: 95%;
      padding: 6px;
    }

    /* ===== æå‡ºãƒœã‚¿ãƒ³ä¸­å¤®å¯„ã› ===== */
    .submit-center {
      text-align: center;
    }

    /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .modal {
      background: #fff;
      max-width: 520px;
      padding: 32px;
      border: 1px solid #ccc;
    }
    .modal h2 {
      font-size: 14px;
      letter-spacing: 0.12em;
      margin-bottom: 20px;
    }
    .modal p {
      font-size: 14px;
      line-height: 1.9;
      margin-bottom: 16px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 16px;
      margin-top: 24px;
    }

    /* â˜… ãƒ¢ãƒ¼ãƒ€ãƒ«å†…æå‡ºãƒœã‚¿ãƒ³ï¼ˆå¸¸ã«è¦‹ãˆã‚‹ï¼‰ */
    .modal-submit {
      background: #eee;
      color: #000;
      border: 1px solid #333;
      padding: 10px 20px;
      cursor: not-allowed;
      opacity: 0.4;
    }
    .modal-submit.enabled {
      background: #111;
      color: #fff;
      cursor: pointer;
      opacity: 1;
    }

    .guard-text {
      font-size: 12px;
      color: #b00020;
      margin-top: 12px;
      display: none;
    }

    /* ===== æå‡ºå¾Œæ¼”å‡º ===== */
    .submit-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      text-align: center;
    }
    .submit-overlay.active {
      display: flex;
    }
    .hidden {
      display: none;
    }

    .lock-scroll {
      overflow: hidden;
    }
  </style>
</head>

<body>

<main class="page document-page">

  <h1 class="document-title">å†…éƒ¨èª¿æŸ»å ±å‘Šæ›¸</h1>

  <!-- ===== æ­»äº¡äº‹æ¡ˆ ===== -->
  <section class="document-section">
    <h2>æ­»äº¡äº‹æ¡ˆã®æ•´ç†</h2>

    <table class="report-table" id="killTable">
      <tr>
        <th>è¢«å®³è€…</th>
        <th>æ®ºå®³è€…</th>
      </tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
      <tr><td><input></td><td><input></td></tr>
    </table>
  </section>

  <!-- ===== ã‚¢ãƒãƒãƒªãƒ¼ ===== -->
  <section class="document-section">
    <h2>ã‚¢ãƒãƒãƒªãƒ¼ã®æ‰€åœ¨</h2>
    <textarea id="anomalyAnswer" rows="4" style="width:100%"></textarea>
  </section>

  <!-- ===== å†ç™ºé˜²æ­¢ç­– ===== -->
  <section class="document-section document-secret">
    <h2>å†ç™ºé˜²æ­¢ç­–ã®é¸æŠ</h2>

    <label>
      <input type="radio" name="finalDecision"> ã‚¢ãƒãƒãƒªãƒ¼ã®å®Œå…¨ç ´å£Š
    </label><br>
    <label>
      <input type="radio" name="finalDecision"> ç®¡ç†ãƒ»é‹ç”¨ä½“åˆ¶ã®è¦‹ç›´ã—
    </label><br>
    <label>
      <input type="radio" name="finalDecision"> åˆ¤æ–­ä¸èƒ½ï¼ˆä¿ç•™ï¼‰
    </label>
  </section>

  <!-- ===== ãƒšãƒ¼ã‚¸æå‡ºï¼ˆâ‘ ï¼‰ ===== -->
  <section class="document-section submit-center">
    <button class="primary-button" onclick="openConfirmModal()">
      æå‡ºã™ã‚‹
    </button>
  </section>

</main>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal">
    <h2>æœ€çµ‚ç¢ºèª</h2>

    <p>
      æœ¬å ±å‘Šã‚’æå‡ºã—ãŸå ´åˆã€<br>
      å†…å®¹ã®ä¿®æ­£ãŠã‚ˆã³å†æå‡ºã¯ã§ãã¾ã›ã‚“ã€‚
    </p>

    <!-- ğŸ”´â‘£ æœªé¸æŠã‚¬ãƒ¼ãƒ‰è¡¨ç¤º -->
    <p class="guard-text" id="guardText">
      â€» å†ç™ºé˜²æ­¢ç­–ã‚’é¸æŠã—ã¦ãã ã•ã„
    </p>

    <div class="modal-actions">
      <button onclick="closeModal()">æˆ»ã‚‹</button>

      <!-- ğŸ”´â‘¡ æœ€çµ‚æå‡ºãƒœã‚¿ãƒ³ -->
      <button id="finalSubmitBtn" class="modal-submit">
        æå‡ºã™ã‚‹
      </button>
    </div>
  </div>
</div>

<!-- ===== æå‡ºå¾Œæ¼”å‡º ===== -->
<div id="submit-overlay" class="submit-overlay">
  <div>
    <p>å ±å‘Šæ›¸ã‚’æå‡ºã—ã¦ã„ã¾ã™â€¦</p>
    <p id="line2" class="hidden">è©•ä¾¡ã‚’ç®—å‡ºã—ã¦ã„ã¾ã™â€¦</p>
  </div>
</div>

<script>
/* =========================
   æ­£è§£ãƒ‡ãƒ¼ã‚¿
   ========================= */
const correctPairs = [
  ["ã‚¯ãƒ¬ã‚¢ãƒ»ã‚¿ã‚¦ãƒŠãƒ¼", "ã‚¢ãƒ³ãƒãƒ¼ãƒ»ã‚¤ã‚§ã‚¤ãƒ„"],
  ["ãƒ–ãƒ©ãƒƒãƒ‰ãƒªãƒ¼ãƒ»ãƒ›ãƒ¼ã‚¹ã‚¦ãƒƒãƒ‰", "ã‚¢ãƒ³ãƒãƒ¼ãƒ»ã‚¤ã‚§ã‚¤ãƒ„"],
  ["ãƒ€ã‚¹ãƒ†ã‚£ãƒ³ãƒ»ãƒã‚¯ãƒãƒ›ãƒ³", "ãƒ•ã‚§ãƒªãƒƒã‚¯ã‚¹ãƒ»ã‚ªãƒ¼ã‚¦ã‚§ãƒ³"],
  ["ã‚¢ãƒ³ãƒãƒ¼ãƒ»ã‚¤ã‚§ã‚¤ãƒ„", "ãƒ•ã‚§ãƒªãƒƒã‚¯ã‚¹ãƒ»ã‚ªãƒ¼ã‚¦ã‚§ãƒ³"],
  ["ã‚¸ãƒ£ãƒãƒƒãƒˆãƒ»ãƒ•ã‚©ã‚¹ã‚¿ãƒ¼", "ã‚¤ã‚µã‚¯ãƒ»ã‚¨ãƒãƒ¢ãƒˆ"],
  ["ã‚¤ã‚µã‚¯ãƒ»ã‚¨ãƒãƒ¢ãƒˆ", "ãƒ¡ãƒ†ã‚£ã‚¹ãƒ»ã‚¼ã‚ºãƒ«ã‚«"],
  ["ãƒãƒ«ãƒŠãƒ»ã‚­ãƒã‚µã‚­", "ãƒ¡ãƒ†ã‚£ã‚¹ãƒ»ã‚¼ã‚ºãƒ«ã‚«"]
];

const anomalyCorrect = ["ã‚¢ã‚¤ãƒˆãƒãƒ»ãƒãƒ©ãƒ†ã‚£ã‚¨"];

/* =========================
   ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ï¼ˆâ‘ ï¼‰
   ========================= */
function openConfirmModal() {
  document.getElementById("confirmModal").style.display = "flex";
}
function closeModal() {
  document.getElementById("confirmModal").style.display = "none";
}

/* =========================
   ğŸ”´â‘£ æœªé¸æŠã‚¬ãƒ¼ãƒ‰
   ========================= */
const radios = document.querySelectorAll('input[name="finalDecision"]');
const submitBtn = document.getElementById("finalSubmitBtn");
const guardText = document.getElementById("guardText");

radios.forEach(r => {
  r.addEventListener("change", () => {
    submitBtn.classList.add("enabled");
    submitBtn.disabled = false;
    guardText.style.display = "none";
  });
});

/* =========================
   ğŸ”´â˜…æœ¬å‘½ï¼šæœ€çµ‚æå‡ºå‡¦ç†
   ========================= */
submitBtn.addEventListener("click", () => {
  if (!submitBtn.classList.contains("enabled")) {
    guardText.style.display = "block";
    return;
  }

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ‹˜æŸï¼‹æ¼”å‡º
  document.body.classList.add("lock-scroll");
  document.getElementById("confirmModal").style.display = "none";

  const overlay = document.getElementById("submit-overlay");
  overlay.classList.add("active");

  setTimeout(() => {
    document.getElementById("line2").classList.remove("hidden");
  }, 600);

  // æ¡ç‚¹
  let score = 0;
  document.querySelectorAll("#killTable tr").forEach((row, i) => {
    if (i === 0) return;
    const v = row.children[0].querySelector("input").value.trim();
    const k = row.children[1].querySelector("input").value.trim();
    if (correctPairs.some(p => p[0] === v && p[1] === k)) score += 10;
  });

  const anomaly = document.getElementById("anomalyAnswer").value;
  if (anomalyCorrect.some(a => anomaly.includes(a))) score += 30;

  let rank = "C";
  if (score === 100) rank = "S";
  else if (score >= 80) rank = "A";
  else if (score >= 50) rank = "B";

  sessionStorage.setItem("score", score);
  sessionStorage.setItem("rank", rank);

  setTimeout(() => {
    window.location.href = "epilog.html";
  }, 1600);
});
</script>

</body>
</html>
